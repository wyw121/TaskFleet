---
description: "创建通讯录管理任务模块"
mode: "edit"
tools: ["file-system", "terminal"]
---

# 通讯录管理模块开发

创建一个完整的通讯录导入和关注执行模块，包含以下功能：

## 功能要求

### 1. 平台区分界面
- 创建小红书和抖音两个子模块选项卡
- 每个平台独立的配置和执行流程
- 统一的UI设计风格使用qfluentwidgets

### 2. 文件导入功能
- 支持CSV和TXT格式文件上传
- 文件内容验证和预览
- 显示导入数据总量统计
- 错误处理和用户友好提示

### 3. 设备分配显示
- 实时显示已连接设备列表（最多10台）
- 支持设备多选和全选功能
- 显示每设备分配的任务量
- 任务均匀分配算法实现

### 4. 余额和计费集成
- 实时显示当前用户余额
- 任务提交前余额检查
- 成功关注后的扣费逻辑
- 与服务器端计费API同步

### 5. 任务执行界面
- 进度条显示（总进度和设备进度）
- 实时状态更新和日志显示
- 暂停/恢复/停止控制
- 完成统计和报告

## 技术实现要求

```python
# 示例组件结构
from qfluentwidgets import (
    VerticalScrollInterface, PrimaryPushButton,
    SettingCardGroup, ComboBoxSettingCard,
    ProgressBar, TableWidget, InfoBar
)

class ContactManagementInterface(VerticalScrollInterface):
    def __init__(self):
        super().__init__(
            object_name="contact_management",
            nav_text_cn="通讯录管理",
            nav_icon=FluentIcon.CONTACT
        )
        self.setup_ui()

    def setup_ui(self):
        # 平台选择区域
        # 文件导入区域
        # 设备分配区域
        # 余额显示区域
        # 执行控制区域
```

## 关键功能

1. **文件上传处理**: 使用QFileDialog选择文件，pandas读取CSV/TXT
2. **数据验证**: 检查文件格式、用户ID有效性、去重处理
3. **设备通信**: 通过ADB接口与已连接设备通信
4. **任务分配**: 实现负载均衡的任务分配算法
5. **状态同步**: 与服务器端实时同步执行状态和计费信息

## UI布局参考

```
┌─────────────────────────────────────────┐
│ [小红书] [抖音] 平台选择选项卡            │
├─────────────────────────────────────────┤
│ 📁 导入通讯录文件                        │
│ [选择文件] 当前: 无文件选择               │
│ 总计: 0 条用户数据                       │
├─────────────────────────────────────────┤
│ 📱 设备分配 (3/10 已连接)                │
│ ☑ 设备1 - iPhone13 (分配: 150条)         │
│ ☑ 设备2 - 小米11 (分配: 150条)           │
│ ☑ 设备3 - 华为P40 (分配: 150条)          │
├─────────────────────────────────────────┤
│ 💰 当前余额: ¥1,250.00                   │
│ 预计扣费: ¥450.00 (450关注 × ¥1.00)      │
├─────────────────────────────────────────┤
│ [开始关注] [暂停] [停止]                  │
│ ████████████░░░░░░░░ 65% (292/450)       │
└─────────────────────────────────────────┘
```

参考现有的GUI开发指令和qfluentwidgets组件库创建现代化界面。
