# TaskFleet Employee Client - 测试指南

## 📋 测试环境

### 前置条件
1. **后端服务器**: 确保TaskFleet后端服务运行在 `http://localhost:8000`
2. **测试账号**: 准备一个员工角色的测试账号
   - 用户名: `employee1` (或其他)
   - 密码: `password123` (或设定的密码)

### 启动应用

#### 方式1: 开发模式(推荐)
```powershell
cd D:\repositories\TaskFleet\employee-client
cargo tauri dev
```

#### 方式2: 直接运行
```powershell
cd D:\repositories\TaskFleet\employee-client\src-tauri
cargo run
```

#### 方式3: 生产构建
```powershell
cd D:\repositories\TaskFleet\employee-client
cargo tauri build
# 可执行文件在: target/release/bundle/nsis/TaskFleet Employee Client_0.1.0_x64-setup.exe
```

## ✅ 功能测试清单

### 1. 登录测试

**步骤:**
1. 启动应用,应该看到登录页面
2. 输入用户名: `employee1`
3. 输入密码: (你的密码)
4. 确认服务器地址: `http://localhost:8000`
5. 点击"登录"按钮

**期望结果:**
- ✅ 登录成功后进入任务管理主页
- ✅ 页面顶部显示用户名
- ✅ 显示任务列表(如果有分配的任务)

**可能的问题:**
- ❌ 如果提示"登录失败",检查:
  1. 后端服务器是否运行 (`http://localhost:8000`能访问吗?)
  2. 用户名和密码是否正确
  3. 账号角色是否为"employee"

### 2. 任务列表测试

**步骤:**
1. 登录成功后,在"我的任务"标签页
2. 观察任务列表

**期望结果:**
- ✅ 显示分配给当前用户的所有任务
- ✅ 每个任务卡片显示:
  - 任务标题
  - 状态徽章(待处理/进行中/已完成)
  - 优先级徽章(低/中/高/紧急)
  - 截止日期(如果有)
  - 预计时间(如果有)
  - 操作按钮(开始/完成/详情)

### 3. 任务筛选测试

**步骤:**
1. 点击"状态"下拉菜单
2. 选择"进行中"
3. 点击"优先级"下拉菜单
4. 选择"高"

**期望结果:**
- ✅ 任务列表只显示"进行中"且"高优先级"的任务
- ✅ 筛选条件可以单独或组合使用

### 4. 开始任务测试

**步骤:**
1. 找到一个"待处理"状态的任务
2. 点击"开始"按钮

**期望结果:**
- ✅ 任务状态变为"进行中"
- ✅ 页面顶部显示活动工作会话横幅
- ✅ 会话横幅显示正在进行的任务名称
- ✅ 会话横幅显示实时计时器(秒数增加)
- ✅ 任务列表自动刷新

### 5. 工作会话计时测试

**步骤:**
1. 确保有任务正在进行(有活动会话)
2. 观察页面顶部的工作会话横幅
3. 计时器应该每秒增加

**期望结果:**
- ✅ 计时器格式: `HH:MM:SS` (例如: `00:05:23`)
- ✅ 计时从0开始,每秒递增
- ✅ 页面刷新后计时不会重置(从服务器同步)

### 6. 完成任务测试

**步骤:**
1. 找到一个"进行中"的任务
2. 点击"完成"按钮

**期望结果:**
- ✅ 任务状态变为"已完成"
- ✅ 工作会话自动结束
- ✅ 会话横幅消失
- ✅ 任务列表自动刷新

### 7. 查看任务详情测试

**步骤:**
1. 点击任何任务卡片上的"详情"按钮

**期望结果:**
- ✅ 弹出模态框显示任务详细信息
- ✅ 显示完整描述、创建者、创建时间等
- ✅ 点击"关闭"或模态框外部可关闭

### 8. 工作记录查看测试

**步骤:**
1. 点击顶部的"工作记录"标签
2. 查看工作记录列表

**期望结果:**
- ✅ 显示所有工作记录
- ✅ 每条记录显示:
  - 任务名称
  - 工作时长
  - 备注
  - 创建时间

### 9. 添加工作记录测试

**步骤:**
1. 在"工作记录"标签页
2. 点击"添加工作记录"按钮
3. 填写表单:
   - 选择任务
   - 输入工作小时数(例如: `2.5`)
   - 输入备注(例如: `完成了界面设计`)
4. 点击"保存"

**期望结果:**
- ✅ 模态框关闭
- ✅ 工作记录列表自动刷新
- ✅ 新记录出现在列表顶部

### 10. 工作记录筛选测试

**步骤:**
1. 在"工作记录"标签页
2. 选择日期范围
3. 选择特定任务

**期望结果:**
- ✅ 只显示符合条件的工作记录
- ✅ 筛选是实时的

### 11. 自动刷新测试

**步骤:**
1. 登录应用并保持在任务列表页面
2. 等待30秒(或在代码中查看刷新间隔)

**期望结果:**
- ✅ 任务列表自动重新加载
- ✅ 活动会话信息自动更新
- ✅ 没有明显的页面闪烁

### 12. 设置页面测试

**步骤:**
1. 点击顶部的"设置"标签

**期望结果:**
- ✅ 显示用户信息
- ✅ 显示应用版本号
- ✅ 显示服务器连接状态

### 13. 退出登录测试

**步骤:**
1. 点击顶部的"退出登录"按钮

**期望结果:**
- ✅ 返回登录页面
- ✅ 用户状态被清除
- ✅ 任务数据被清空

## 🐛 常见问题排查

### 问题1: 应用无法启动

**症状**: `cargo tauri dev` 或 `cargo run` 后应用立即退出

**排查步骤:**
1. 检查编译输出是否有错误
2. 查看日志输出(如果启用了tracing)
3. 确认 `tauri.conf.json` 配置正确
4. 确认 `src-web/index.html` 存在且可访问

### 问题2: 登录失败

**症状**: 点击登录后提示错误

**排查步骤:**
1. 打开浏览器访问 `http://localhost:8000`,确认后端运行
2. 检查后端日志,查看API请求是否到达
3. 使用Postman测试登录API: `POST http://localhost:8000/api/auth/login`
4. 检查用户名、密码、角色是否正确

### 问题3: 任务列表为空

**症状**: 登录成功但看不到任务

**排查步骤:**
1. 确认数据库中有分配给该用户的任务
2. 在后端日志中检查 `/api/tasks?assigned_to=me` 请求
3. 使用浏览器开发者工具(如果Tauri支持)查看API响应

### 问题4: 工作会话计时不准确

**症状**: 计时器不动或时间不对

**排查步骤:**
1. 检查 `start_task` API是否成功创建了work session
2. 确认 `get_active_work_session` 返回了正确的开始时间
3. 检查JavaScript的 `updateSessionTimer` 函数是否正常执行

### 问题5: 窗口不显示

**症状**: 程序运行但看不到窗口

**排查步骤:**
1. 检查任务栏是否有应用图标
2. 按 `Alt+Tab` 切换窗口查看
3. 检查 `tauri.conf.json` 中的窗口配置
4. 尝试修改窗口的初始位置

## 📝 测试记录模板

```
测试日期: ____________________
测试人员: ____________________
应用版本: v0.1.0

| 测试项 | 通过 | 失败 | 备注 |
|--------|------|------|------|
| 1. 登录 | ☐ | ☐ | |
| 2. 任务列表 | ☐ | ☐ | |
| 3. 任务筛选 | ☐ | ☐ | |
| 4. 开始任务 | ☐ | ☐ | |
| 5. 工作会话计时 | ☐ | ☐ | |
| 6. 完成任务 | ☐ | ☐ | |
| 7. 查看详情 | ☐ | ☐ | |
| 8. 工作记录查看 | ☐ | ☐ | |
| 9. 添加工作记录 | ☐ | ☐ | |
| 10. 工作记录筛选 | ☐ | ☐ | |
| 11. 自动刷新 | ☐ | ☐ | |
| 12. 设置页面 | ☐ | ☐ | |
| 13. 退出登录 | ☐ | ☐ | |

问题汇总:
________________________________________
________________________________________
________________________________________
```

## 🎯 下一步

测试完成后:
1. 记录所有发现的问题
2. 修复关键bug
3. 优化用户体验
4. 准备生产环境部署
5. 更新文档

---

**重要提示**: 
- 首次运行可能需要较长编译时间(2-5分钟)
- 开发模式会有更多日志输出
- 生产构建会移除debug信息,体积更小
