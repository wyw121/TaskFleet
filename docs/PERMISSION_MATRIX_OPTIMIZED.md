# TaskFleet 优化后权限矩阵

## 权限分配总览

| 功能模块 | 功能点 | PlatformAdmin | ProjectManager | TaskExecutor |
|---------|--------|---------------|----------------|--------------|
| **仪表板** | 查看个人仪表板 | ✅ | ✅ | ✅ |
| | 查看团队数据 | ❌ | ✅ | ❌ |
| | 查看全局数据 | ✅ | ❌ | ❌ |
| **公司管理** | 查看所有公司 | ✅ | ❌ | ❌ |
| | 创建公司 | ✅ | ❌ | ❌ |
| | 编辑公司 | ✅ | ❌ | ❌ |
| | 删除公司 | ✅ | ❌ | ❌ |
| | 配置公司计费 | ✅ | ❌ | ❌ |
| **用户管理** | 查看所有用户 | ✅ | ❌ | ❌ |
| | 查看本公司用户 | ❌ | ✅ | ✅ (只读) |
| | 创建用户 | ✅ (任意公司) | ✅ (仅本公司) | ❌ |
| | 编辑用户 | ✅ (任意用户) | ✅ (仅本公司) | ❌ |
| | 删除用户 | ✅ | ✅ (仅本公司) | ❌ |
| | 重置密码 | ✅ | ✅ (仅本公司) | ❌ |
| **项目管理** | 查看所有项目 | ✅ | ❌ | ❌ |
| | 查看本公司项目 | ❌ | ✅ | ✅ |
| | 创建项目 | ❌ | ✅ | ❌ |
| | 编辑项目 | ❌ | ✅ (仅自己创建的) | ❌ |
| | 删除项目 | ❌ | ✅ (需二次确认) | ❌ |
| | 归档项目 | ❌ | ✅ | ❌ |
| **任务管理** | 查看所有任务 | ✅ | ❌ | ❌ |
| | 查看本公司任务 | ❌ | ✅ | ✅ (仅相关任务) |
| | 创建任务 | ❌ | ✅ | ✅ (子任务/问题反馈) |
| | 编辑任务 | ❌ | ✅ (任意) | ✅ (仅分配给自己的) |
| | 删除任务 | ❌ | ✅ (需确认) | ❌ |
| | 分配任务 | ❌ | ✅ | ❌ |
| | 开始任务 | ❌ | ✅ | ✅ |
| | 完成任务 | ❌ | ✅ | ✅ |
| | 更新进度 | ❌ | ✅ | ✅ |
| | 添加评论 | ❌ | ✅ | ✅ |
| **数据分析** | 查看全平台分析 | ✅ | ❌ | ❌ |
| | 查看本公司分析 | ❌ | ✅ | ❌ |
| | 导出报表 | ✅ | ✅ | ❌ |
| **系统设置** | 系统配置 | ✅ | ❌ | ❌ |
| | 公司设置 | ❌ | ✅ | ❌ |
| | 个人设置 | ✅ | ✅ | ✅ |

## 关键设计原则

### 1. 数据隔离原则
- **PlatformAdmin**: 跨公司数据访问（平台级）
- **ProjectManager**: 仅访问本公司数据
- **TaskExecutor**: 仅访问相关任务数据

### 2. 最小权限原则
- 每个角色仅获得完成工作所需的最小权限
- 高风险操作需要二次确认

### 3. 职责分离原则
- PlatformAdmin 不参与具体业务
- ProjectManager 负责团队管理和业务执行
- TaskExecutor 聚焦任务完成

## 实施建议

### 阶段一：前端权限控制
1. 更新 `usePermissions.ts` - 细化权限检查函数
2. 更新路由配置 - 限制页面访问
3. 更新 UI 组件 - 按角色显示/隐藏按钮

### 阶段二：后端权限验证
1. 添加数据隔离中间件
2. 实现基于公司的资源过滤
3. 添加操作权限校验

### 阶段三：审计和测试
1. 添加操作日志
2. 权限测试用例
3. 安全审计
